
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This repository contains the Python Emission Localization and Quantification software we call pyELQ. It is code used for gas dispersion modelling, in particular methane emissions detection, localization and quantification.">
      
      
        <meta name="author" content="pyELQ">
      
      
      
        <link rel="prev" href="../offset/">
      
      
        <link rel="next" href="../../coordinate_system/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Source Model - pyELQ Python Emission Localization and Quantification</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


  
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--pipelines{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M160%20169.3c28.3-12.3%2048-40.5%2048-73.3%200-44.2-35.8-80-80-80S48%2051.8%2048%2096c0%2032.8%2019.7%2061%2048%2073.3V224H32c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h224v54.7c-28.3%2012.3-48%2040.5-48%2073.3%200%2044.2%2035.8%2080%2080%2080s80-35.8%2080-80c0-32.8-19.7-61-48-73.3V288h224c17.7%200%2032-14.3%2032-32s-14.3-32-32-32h-64v-54.7c28.3-12.3%2048-40.5%2048-73.3%200-44.2-35.8-80-80-80s-80%2035.8-80%2080c0%2032.8%2019.7%2061%2048%2073.3V224H160z%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#source-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="pyELQ Python Emission Localization and Quantification" class="md-header__button md-logo" aria-label="pyELQ Python Emission Localization and Quantification" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyELQ Python Emission Localization and Quantification
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Source Model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sede-open/pyELQ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pyELQ
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../component/" class="md-tabs__link">
          
  
  
    
  
  pyELQ User Guide

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="pyELQ Python Emission Localization and Quantification" class="md-nav__button md-logo" aria-label="pyELQ Python Emission Localization and Quantification" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pyELQ Python Emission Localization and Quantification
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sede-open/pyELQ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pyELQ
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    pyELQ User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    pyELQ User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Components
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Components
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../component/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../background/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../offset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Offset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Source Model
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Source Model
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        source_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.ParameterMapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        ParameterMapping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ParameterMapping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.ParameterMapping.append_string" class="md-nav__link">
    <span class="md-ellipsis">
      
        append_string
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceGrouping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceGrouping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        NullGrouping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NullGrouping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike" class="md-nav__link">
    <span class="md-ellipsis">
      
        SlabAndSpike
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlabAndSpike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceDistribution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.from_mcmc_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_dist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        NormalResponse
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalResponse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.from_mcmc_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_dist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.nof_sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        nof_sources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.coverage_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      
        coverage_threshold
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __post_init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.initialise" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialise
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.initialise_dispersion_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialise_dispersion_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.screen_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        screen_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.compute_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.update_coupling_column" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_coupling_column
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.birth_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        birth_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.death_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        death_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.move_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        move_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_sampler_rjmcmc" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_sampler_rjmcmc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.from_mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.plot_iterations" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_iterations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.Normal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalSlabAndSpike" class="md-nav__link">
    <span class="md-ellipsis">
      
        NormalSlabAndSpike
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coordinate_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coordinate System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_access/data_access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dispersion Model
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dispersion Model
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispersion_model/dispersion_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispersion_model/finite_volume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Finite Volume
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispersion_model/gaussian_plume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gaussian Plume
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispersion_model/site_layout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Site Layout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dlm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DLM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gas_species/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gas Species
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Meteorology
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Meteorology
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meteorology/meteorology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meteorology/meteorology_windfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windfield
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plotting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pre-Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sensor
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sensor
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sensor/sensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sensor/beam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beam
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sensor/satellite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Satellite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../source_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Source Map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Support Functions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Support Functions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support_functions/spatio_temporal_interpolation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spatio Temporal Interpolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support_functions/post_processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Post Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        source_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.ParameterMapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        ParameterMapping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ParameterMapping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.ParameterMapping.append_string" class="md-nav__link">
    <span class="md-ellipsis">
      
        append_string
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceGrouping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceGrouping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceGrouping.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        NullGrouping
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NullGrouping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NullGrouping.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike" class="md-nav__link">
    <span class="md-ellipsis">
      
        SlabAndSpike
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlabAndSpike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.make_allocation_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_allocation_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SlabAndSpike.from_mcmc_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceDistribution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.make_source_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceDistribution.from_mcmc_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_dist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        NormalResponse
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalResponse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.make_source_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_source_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalResponse.from_mcmc_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc_dist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        SourceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.nof_sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        nof_sources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.coverage_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      
        coverage_threshold
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __post_init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.initialise" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialise
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.initialise_dispersion_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialise_dispersion_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.screen_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        screen_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.compute_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.update_coupling_column" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_coupling_column
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.birth_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        birth_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.death_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        death_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.move_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        move_function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_sampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.make_sampler_rjmcmc" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_sampler_rjmcmc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.from_mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_mcmc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyelq.component.source_model.SourceModel.plot_iterations" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_iterations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.Normal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyelq.component.source_model.NormalSlabAndSpike" class="md-nav__link">
    <span class="md-ellipsis">
      
        NormalSlabAndSpike
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<!--
SPDX-FileCopyrightText: 2024 Shell Global Solutions International B.V. All Rights Reserved.

SPDX-License-Identifier: Apache-2.0
-->

<h1 id="source-model">Source Model</h1>


<div class="doc doc-object doc-module">



<a id="pyelq.component.source_model"></a>
    <div class="doc doc-contents first">

        <p>Component Class and subclasses for source model.</p>


<details class="a-sourcemodel-instance-inherits-from-3-super-classes" open>
  <summary>A SourceModel instance inherits from 3 super-classes</summary>
  <ul>
<li>Component: this is the general superclass for ELQModel components, which prototypes generic methods.</li>
<li>A type of SourceGrouping: this class type implements an allocation of sources to different categories (e.g. slab
    or spike), and sets up a sampler for estimating the classification of each source within the source map.
    Inheriting from the NullGrouping class ensures that the allocation of all sources is fixed during the inversion,
    and is not updated.</li>
<li>A type of SourceDistribution: this class type implements a particular type of response distribution (mostly
    Normal, but also allows for cases where we have e.g. exp(log_s) or a non-Gaussian prior).</li>
</ul>
</details>









<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.ParameterMapping" class="doc doc-heading">
            <code>ParameterMapping</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Class for defining mapping variable/parameter labels needed for creating an analysis.</p>
<p>In instances where we want to include multiple source_model instances in an MCMC analysis, we can apply a suffix to
all of the parameter names in the mapping dictionary. This allows us to create separate variables for different
source map types, so that these can be associated with different sampler types in the MCMC analysis.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.ParameterMapping.map">map</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing mapping between variable types and MCMC parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParameterMapping</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for defining mapping variable/parameter labels needed for creating an analysis.</span>

<span class="sd">    In instances where we want to include multiple source_model instances in an MCMC analysis, we can apply a suffix to</span>
<span class="sd">    all of the parameter names in the mapping dictionary. This allows us to create separate variables for different</span>
<span class="sd">    source map types, so that these can be associated with different sampler types in the MCMC analysis.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        map (dict): dictionary containing mapping between variable types and MCMC parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;coupling_matrix&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">:</span> <span class="s2">&quot;mu_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;allocation&quot;</span><span class="p">:</span> <span class="s2">&quot;alloc_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;source_prob&quot;</span><span class="p">:</span> <span class="s2">&quot;s_prob&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precision_prior_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;a_lam_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precision_prior_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;b_lam_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;source_location&quot;</span><span class="p">:</span> <span class="s2">&quot;z_src&quot;</span><span class="p">,</span>
            <span class="s2">&quot;number_sources&quot;</span><span class="p">:</span> <span class="s2">&quot;n_src&quot;</span><span class="p">,</span>
            <span class="s2">&quot;number_source_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the supplied string as a suffix to all of the values in the mapping dictionary.</span>

<span class="sd">        For example: {&#39;source&#39;: &#39;s&#39;} would become {&#39;source&#39;: &#39;s_fixed&#39;} when string = &#39;fixed&#39; is passed as the argument.</span>
<span class="sd">        If string is None, nothing is appended.</span>

<span class="sd">        Args:</span>
<span class="sd">            string (str): string to append to the variable names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">string</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.ParameterMapping.append_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_string</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply the supplied string as a suffix to all of the values in the mapping dictionary.</p>
<p>For example: {'source': 's'} would become {'source': 's_fixed'} when string = 'fixed' is passed as the argument.
If string is None, nothing is appended.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>string</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string to append to the variable names.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply the supplied string as a suffix to all of the values in the mapping dictionary.</span>

<span class="sd">    For example: {&#39;source&#39;: &#39;s&#39;} would become {&#39;source&#39;: &#39;s_fixed&#39;} when string = &#39;fixed&#39; is passed as the argument.</span>
<span class="sd">    If string is None, nothing is appended.</span>

<span class="sd">    Args:</span>
<span class="sd">        string (str): string to append to the variable names.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">string</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.SourceGrouping" class="doc doc-heading">
            <code>SourceGrouping</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;ParameterMapping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.ParameterMapping&lt;/code&gt;)" href="#pyelq.component.source_model.ParameterMapping">ParameterMapping</a></code></p>



        <p>Superclass for source grouping approach.</p>
<p>Source grouping method determines the group allocation of each source in the model, e.g: slab and spike
distribution makes an on/off allocation for each source.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceGrouping.nof_sources">nof_sources</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sources in the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceGrouping.emission_rate_mean">emission_rate_mean</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prior mean parameter for the emission rate distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceGrouping</span><span class="p">(</span><span class="n">ParameterMapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass for source grouping approach.</span>

<span class="sd">    Source grouping method determines the group allocation of each source in the model, e.g: slab and spike</span>
<span class="sd">    distribution makes an on/off allocation for each source.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nof_sources (int): number of sources in the model.</span>
<span class="sd">        emission_rate_mean (Union[float, np.ndarray]): prior mean parameter for the emission rate distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nof_sources</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">emission_rate_mean</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model, and the parameters of the source response distribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): overall model, consisting of list of distributions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: overall model list, updated with allocation distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): overall model, consisting of list of distributions.</span>
<span class="sd">            sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing current state information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: state updated with parameters related to the source grouping.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceGrouping.make_allocation_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the source allocation part of the model, and the parameters of the source response distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model list, updated with allocation distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model, and the parameters of the source response distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): overall model, consisting of list of distributions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: overall model list, updated with allocation distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceGrouping.make_allocation_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the sampler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers for individual parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler_list updated with sampler for the source allocation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): overall model, consisting of list of distributions.</span>
<span class="sd">        sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceGrouping.make_allocation_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing current state information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state updated with parameters related to the source grouping.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing current state information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: state updated with parameters related to the source grouping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceGrouping.from_mcmc_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc_group</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Extract posterior allocation samples from the MCMC sampler, attach them to the class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing samples from the MCMC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.NullGrouping" class="doc doc-heading">
            <code>NullGrouping</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceGrouping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceGrouping&lt;/code&gt;)" href="#pyelq.component.source_model.SourceGrouping">SourceGrouping</a></code></p>



        <p>Null grouping: the grouping of the sources will not change during the course of the inversion.</p>


<details class="note-that-this-is-intended-to-support-two-distinct-cases" open>
  <summary>Note that this is intended to support two distinct cases</summary>
  <p>1) The case where the source map is fixed, and a given prior mean and prior precision value are assigned to
    each source (can be a common value for all sources, or can be a distinct allocation to each element of the
    source map).
2) The case where the dimensionality of the source map is changing during the inversion, and a common prior
    mean and precision term are used for all sources.</p>
</details>        <p>number_on_sources (np.ndarray): number of sources switched on in the solution, per iteration. Extracted as a
    property from the MCMC samples in self.from_mcmc_group().</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NullGrouping</span><span class="p">(</span><span class="n">SourceGrouping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Null grouping: the grouping of the sources will not change during the course of the inversion.</span>

<span class="sd">    Note that this is intended to support two distinct cases:</span>
<span class="sd">        1) The case where the source map is fixed, and a given prior mean and prior precision value are assigned to</span>
<span class="sd">            each source (can be a common value for all sources, or can be a distinct allocation to each element of the</span>
<span class="sd">            source map).</span>
<span class="sd">        2) The case where the dimensionality of the source map is changing during the inversion, and a common prior</span>
<span class="sd">            mean and precision term are used for all sources.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    number_on_sources (np.ndarray): number of sources switched on in the solution, per iteration. Extracted as a</span>
<span class="sd">        property from the MCMC samples in self.from_mcmc_group().</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number_on_sources</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model.</span>

<span class="sd">        In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply</span>
<span class="sd">        returns the existing model un-modified).</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: overall model list, updated with allocation distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">        In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply</span>
<span class="sd">        returns the existing sampler list un-modified).</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): overall model set for the problem.</span>
<span class="sd">            sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sampler_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">        The prior mean parameter and the fixed source allocation are added to the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing current state information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: state updated with parameters related to the source grouping.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_mean</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">        Gets the number of sources present in each iteration of the MCMC sampler, and attaches this as a class property.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_on_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NullGrouping.make_allocation_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the source allocation part of the model.</p>
<p>In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply
returns the existing model un-modified).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model as constructed so far, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model list, updated with allocation distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model.</span>

<span class="sd">    In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply</span>
<span class="sd">    returns the existing model un-modified).</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: overall model list, updated with allocation distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NullGrouping.make_allocation_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the sampler.</p>
<p>In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply
returns the existing sampler list un-modified).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model set for the problem.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers for individual parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler_list updated with sampler for the source allocation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">    In the NullGrouping case, the source allocation is fixed throughout, so this function does nothing (simply</span>
<span class="sd">    returns the existing sampler list un-modified).</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): overall model set for the problem.</span>
<span class="sd">        sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sampler_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NullGrouping.make_allocation_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the state.</p>
<p>The prior mean parameter and the fixed source allocation are added to the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing current state information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state updated with parameters related to the source grouping.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">    The prior mean parameter and the fixed source allocation are added to the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing current state information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: state updated with parameters related to the source grouping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_mean</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NullGrouping.from_mcmc_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc_group</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract posterior allocation samples from the MCMC sampler, attach them to the class.</p>
<p>Gets the number of sources present in each iteration of the MCMC sampler, and attaches this as a class property.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing samples from the MCMC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">    Gets the number of sources present in each iteration of the MCMC sampler, and attaches this as a class property.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_on_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.SlabAndSpike" class="doc doc-heading">
            <code>SlabAndSpike</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceGrouping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceGrouping&lt;/code&gt;)" href="#pyelq.component.source_model.SourceGrouping">SourceGrouping</a></code></p>



        <p>Slab and spike source model, special case for the source grouping.</p>
<p>Slab and spike: the prior for the emission rates is a two-component mixture, and the allocation is to be
estimated as part of the inversion.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SlabAndSpike.slab_probability">slab_probability</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prior probability of allocation to the slab component. Defaults to 0.05.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SlabAndSpike.allocation">allocation</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set of allocation samples, with shape=(n_sources, n_iterations). Attached to
the class by self.from_mcmc_group().</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SlabAndSpike.number_on_sources">number_on_sources</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sources switched on in the solution, per iteration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SlabAndSpike</span><span class="p">(</span><span class="n">SourceGrouping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Slab and spike source model, special case for the source grouping.</span>

<span class="sd">    Slab and spike: the prior for the emission rates is a two-component mixture, and the allocation is to be</span>
<span class="sd">    estimated as part of the inversion.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        slab_probability (float): prior probability of allocation to the slab component. Defaults to 0.05.</span>
<span class="sd">        allocation (np.ndarray): set of allocation samples, with shape=(n_sources, n_iterations). Attached to</span>
<span class="sd">            the class by self.from_mcmc_group().</span>
<span class="sd">        number_on_sources (np.ndarray): number of sources switched on in the solution, per iteration.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">slab_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">allocation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">number_on_sources</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: overall model list, updated with allocation distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Categorical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_prob&quot;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): overall model set for the problem.</span>
<span class="sd">            sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">MixtureAllocation</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">response_param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">sampler_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing current state information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: state updated with parameters related to the source grouping.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_mean</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_prob&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slab_probability</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">slab_probability</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_on_sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SlabAndSpike.make_allocation_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the source allocation part of the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model as constructed so far, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model list, updated with allocation distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the source allocation part of the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: overall model list, updated with allocation distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Categorical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_prob&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SlabAndSpike.make_allocation_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the sampler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model set for the problem.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers for individual parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler_list updated with sampler for the source allocation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): overall model set for the problem.</span>
<span class="sd">        sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler_list updated with sampler for the source allocation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">MixtureAllocation</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">response_param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sampler_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SlabAndSpike.make_allocation_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_allocation_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the allocation part of the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing current state information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state updated with parameters related to the source grouping.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_allocation_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the allocation part of the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing current state information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: state updated with parameters related to the source grouping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_mean</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_prob&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slab_probability</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">slab_probability</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SlabAndSpike.from_mcmc_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc_group</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract posterior allocation samples from the MCMC sampler, attach them to the class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing samples from the MCMC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract posterior allocation samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_on_sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.SourceDistribution" class="doc doc-heading">
            <code>SourceDistribution</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;ParameterMapping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.ParameterMapping&lt;/code&gt;)" href="#pyelq.component.source_model.ParameterMapping">ParameterMapping</a></code></p>



        <p>Superclass for source emission rate distribution.</p>
<p>Source distribution determines the type of prior to be used for the source emission rates, and the transformation
linking the source parameters and the data.</p>
<p>Elements related to transformation of source parameters are also specified at the model level.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceDistribution.nof_sources">nof_sources</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sources in the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceDistribution.emission_rate">emission_rate</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set of emission rate samples, with shape=(n_sources, n_iterations). Attached to
the class by self.from_mcmc_dist().</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceDistribution</span><span class="p">(</span><span class="n">ParameterMapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass for source emission rate distribution.</span>

<span class="sd">    Source distribution determines the type of prior to be used for the source emission rates, and the transformation</span>
<span class="sd">    linking the source parameters and the data.</span>

<span class="sd">    Elements related to transformation of source parameters are also specified at the model level.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nof_sources (int): number of sources in the model.</span>
<span class="sd">        emission_rate (np.ndarray): set of emission rate samples, with shape=(n_sources, n_iterations). Attached to</span>
<span class="sd">            the class by self.from_mcmc_dist().</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nof_sources</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">emission_rate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add distributional component to the overall model corresponding to the source emission rate distribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: overall model list, updated with distributions related to source prior.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the source prior distribution part of the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): overall model set for the problem.</span>
<span class="sd">            sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler_list updated with sampler for the emission rate parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the emission rate parts of the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing current state information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: state updated with parameters related to the source emission rates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract posterior emission rate samples from the MCMC, attach them to the class.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceDistribution.make_source_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Add distributional component to the overall model corresponding to the source emission rate distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model as constructed so far, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model list, updated with distributions related to source prior.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_source_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add distributional component to the overall model corresponding to the source emission rate distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: overall model list, updated with distributions related to source prior.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceDistribution.make_source_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the source prior distribution part of the sampler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model set for the problem.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers for individual parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler_list updated with sampler for the emission rate parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_source_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the source prior distribution part of the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): overall model set for the problem.</span>
<span class="sd">        sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler_list updated with sampler for the emission rate parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceDistribution.make_source_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the emission rate parts of the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing current state information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state updated with parameters related to the source emission rates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_source_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the emission rate parts of the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing current state information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: state updated with parameters related to the source emission rates.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceDistribution.from_mcmc_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc_dist</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Extract posterior emission rate samples from the MCMC, attach them to the class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing samples from the MCMC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract posterior emission rate samples from the MCMC, attach them to the class.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.NormalResponse" class="doc doc-heading">
            <code>NormalResponse</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceDistribution&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceDistribution&lt;/code&gt;)" href="#pyelq.component.source_model.SourceDistribution">SourceDistribution</a></code></p>



        <p>(Truncated) Gaussian prior for sources.</p>
<p>No transformation applied to parameters, i.e.:
- Prior distribution: s ~ N(mu, 1/precision)
- Likelihood contribution: y = A*s + b + ...</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.NormalResponse.truncation">truncation</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indication of whether the emission rate prior should be truncated at 0. Defaults to True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.NormalResponse.emission_rate_lb">emission_rate_lb</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower bound for the source emission rates. Defaults to 0.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.NormalResponse.emission_rate_mean">emission_rate_mean</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prior mean for the emission rate distribution. Defaults to 0.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NormalResponse</span><span class="p">(</span><span class="n">SourceDistribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;(Truncated) Gaussian prior for sources.</span>

<span class="sd">    No transformation applied to parameters, i.e.:</span>
<span class="sd">    - Prior distribution: s ~ N(mu, 1/precision)</span>
<span class="sd">    - Likelihood contribution: y = A*s + b + ...</span>

<span class="sd">    Attributes:</span>
<span class="sd">        truncation (bool): indication of whether the emission rate prior should be truncated at 0. Defaults to True.</span>
<span class="sd">        emission_rate_lb (Union[float, np.ndarray]): lower bound for the source emission rates. Defaults to 0.</span>
<span class="sd">        emission_rate_mean (Union[float, np.ndarray]): prior mean for the emission rate distribution. Defaults to 0.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">truncation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">emission_rate_lb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">emission_rate_mean</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add distributional component to the overall model corresponding to the source emission rate distribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: model, updated with distributions related to source prior.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">domain_response_lower</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncation</span><span class="p">:</span>
            <span class="n">domain_response_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_lb</span>

        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">mcmcNormal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                <span class="n">mean</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">MixtureParameterVector</span><span class="p">(</span>
                    <span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">],</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">MixtureParameterMatrix</span><span class="p">(</span>
                    <span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">domain_response_lower</span><span class="o">=</span><span class="n">domain_response_lower</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the source prior distribution part of the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): overall model set for the problem.</span>
<span class="sd">            sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler_list updated with sampler for the emission rate parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sampler_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NormalNormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="n">model</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sampler_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_source_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the emission rate part of the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing current state information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: state updated with initial emission rate vector.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract posterior emission rate samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_rate</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NormalResponse.make_source_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add distributional component to the overall model corresponding to the source emission rate distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model as constructed so far, consisting of list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model, updated with distributions related to source prior.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_source_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add distributional component to the overall model corresponding to the source emission rate distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): model as constructed so far, consisting of list of distributions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: model, updated with distributions related to source prior.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">domain_response_lower</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncation</span><span class="p">:</span>
        <span class="n">domain_response_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_rate_lb</span>

    <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mcmcNormal</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">MixtureParameterVector</span><span class="p">(</span>
                <span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_mean&quot;</span><span class="p">],</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">MixtureParameterMatrix</span><span class="p">(</span>
                <span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">domain_response_lower</span><span class="o">=</span><span class="n">domain_response_lower</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NormalResponse.make_source_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the source prior distribution part of the sampler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overall model set for the problem.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers for individual parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler_list updated with sampler for the emission rate parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_source_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the source prior distribution part of the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): overall model set for the problem.</span>
<span class="sd">        sampler_list (list): list of samplers for individual parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler_list updated with sampler for the emission rate parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sampler_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sampler_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NormalNormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="n">model</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sampler_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NormalResponse.make_source_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_source_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the emission rate part of the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing current state information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state updated with initial emission rate vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_source_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the emission rate part of the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing current state information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: state updated with initial emission rate vector.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nof_sources</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.NormalResponse.from_mcmc_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc_dist</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract posterior emission rate samples from the MCMC sampler, attach them to the class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing samples from the MCMC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract posterior emission rate samples from the MCMC sampler, attach them to the class.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): dictionary containing samples from the MCMC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_rate</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.SourceModel" class="doc doc-heading">
            <code>SourceModel</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;Component&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.component.Component&lt;/code&gt;)" href="../component/#pyelq.component.component.Component">Component</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceGrouping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceGrouping&lt;/code&gt;)" href="#pyelq.component.source_model.SourceGrouping">SourceGrouping</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceDistribution&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceDistribution&lt;/code&gt;)" href="#pyelq.component.source_model.SourceDistribution">SourceDistribution</a></code></p>



        <p>Superclass for the specification of the source model in an inversion run.</p>
<p>Various different types of model. A SourceModel is an optional component of a model, and thus inherits
from Component.</p>


<details class="a-subclass-instance-of-sourcemodel-must-inherit-from" open>
  <summary>A subclass instance of SourceModel must inherit from</summary>
  <ul>
<li>an INSTANCE of SourceDistribution, which specifies a prior emission rate distribution for all sources in the
    source map.</li>
<li>an INSTANCE of SourceGrouping, which specifies a type of mixture prior specification for the sources (for
    which the allocation is to be estimated as part of the inversion).</li>
</ul>
</details>        <p>If the flag reversible_jump == True, then the number of sources and their locations are also estimated as part of
the inversion, in addition to the emission rates. If this flag is set to true, the sensor_object, meteorology and
gas_species objects are all attached to the class, as they will be required in the repeated computation of updates
to the coupling matrix during the inversion.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.dispersion_model">dispersion_model</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;GaussianPlume&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.dispersion_model.gaussian_plume.GaussianPlume&lt;/code&gt;)" href="../../dispersion_model/gaussian_plume/#pyelq.dispersion_model.gaussian_plume.GaussianPlume">GaussianPlume</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dispersion model used to generate the couplings between source locations and
sensor observations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.coupling">coupling</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>coupling matrix generated using dispersion_model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.sensor_object">sensor_object</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SensorGroup&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.sensor.sensor.SensorGroup&lt;/code&gt;)" href="../../sensor/sensor/#pyelq.sensor.sensor.SensorGroup">SensorGroup</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stores sensor information for reversible jump coupling updates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.meteorology">meteorology</span></code></td>
            <td>
                  <code><span title="MeteorologyGroup">MeteorologyGroup</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stores meteorology information for reversible jump coupling updates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.gas_species">gas_species</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;GasSpecies&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.gas_species.GasSpecies&lt;/code&gt;)" href="../../gas_species/#pyelq.gas_species.GasSpecies">GasSpecies</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stores gas species information for reversible jump coupling updates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.reversible_jump">reversible_jump</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logical indicating whether the reversible jump algorithm for estimation of the number
of sources and their locations should be run. Defaults to False.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.distribution_number_sources">distribution_number_sources</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>distribution for the number of sources in the solution. Can be either
"Poisson" or "Uniform". Defaults to "Poisson".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.random_walk_step_size">random_walk_step_size</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(3 x 1) array specifying the standard deviations of the distributions
from which the random walk sampler draws new source locations. Defaults to np.array([1.0, 1.0, 0.1]).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.site_limits">site_limits</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(3 x 2) array specifying the lower (column 0) and upper (column 1) limits of the
analysis site. Only relevant for cases where reversible_jump == True (where sources are free to move in
the solution).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.rate_num_sources">rate_num_sources</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specification for the parameter for the Poisson prior distribution for the total number
of sources. Only relevant for cases where reversible_jump == True (where the number of sources in the
solution can change). Unused in the case of a Uniform prior (self.distribution_number_sources == "Uniform").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.n_sources_max">n_sources_max</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of sources that can feature in the solution. Only relevant for cases where
reversible_jump == True (where the number of sources in the solution can change).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.emission_proposal_std">emission_proposal_std</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>standard deviation of the truncated Gaussian distribution used to propose the
new source emission rate in case of a birth move.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.update_precision">update_precision</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logical indicating whether the prior precision parameter for emission rates should be
updated as part of the inversion. Defaults to false.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.prior_precision_shape">prior_precision_shape</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape parameters for the prior Gamma distribution for the
source precision parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.prior_precision_rate">prior_precision_rate</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>rate parameters for the prior Gamma distribution for the
source precision parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.initial_precision">initial_precision</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial value for the source emission rate precision parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.precision_scalar">precision_scalar</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>precision values generated by MCMC inversion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.all_source_locations">all_source_locations</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;ENU&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.coordinate_system.ENU&lt;/code&gt;)" href="../../coordinate_system/#pyelq.coordinate_system.ENU">ENU</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ENU object containing the locations of after the mcmc has been run, therefore in
the situation where the reversible_jump == True, this will be the final locations of the sources in the
solution over all iterations. For the case where reversible_jump == False, this will be the locations of
the sources in the source map and will not change during the course of the inversion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.individual_source_labels">individual_source_labels</span></code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of labels for each source in the source map, defaults to None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.coverage_detection">coverage_detection</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sensor detection threshold (in ppm) to be used for coverage calculations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.coverage_test_source">coverage_test_source</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test source (in kg/hr) which we wish to be able to see in coverage calculation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.threshold_function">threshold_function</span></code></td>
            <td>
                  <code><span title="Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable function which returns a single value that defines the threshold
for the coupling in a lambda function form. Examples: lambda x: np.quantile(x, 0.95, axis=0),
lambda x: np.max(x, axis=0), lambda x: np.mean(x, axis=0). Defaults to np.quantile.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.SourceModel.label_string">label_string</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string to append to the parameter mapping, e.g. for fixed sources, defaults to None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceModel</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="n">SourceGrouping</span><span class="p">,</span> <span class="n">SourceDistribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass for the specification of the source model in an inversion run.</span>

<span class="sd">    Various different types of model. A SourceModel is an optional component of a model, and thus inherits</span>
<span class="sd">    from Component.</span>

<span class="sd">    A subclass instance of SourceModel must inherit from:</span>
<span class="sd">        - an INSTANCE of SourceDistribution, which specifies a prior emission rate distribution for all sources in the</span>
<span class="sd">            source map.</span>
<span class="sd">        - an INSTANCE of SourceGrouping, which specifies a type of mixture prior specification for the sources (for</span>
<span class="sd">            which the allocation is to be estimated as part of the inversion).</span>

<span class="sd">    If the flag reversible_jump == True, then the number of sources and their locations are also estimated as part of</span>
<span class="sd">    the inversion, in addition to the emission rates. If this flag is set to true, the sensor_object, meteorology and</span>
<span class="sd">    gas_species objects are all attached to the class, as they will be required in the repeated computation of updates</span>
<span class="sd">    to the coupling matrix during the inversion.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dispersion_model (GaussianPlume): dispersion model used to generate the couplings between source locations and</span>
<span class="sd">            sensor observations.</span>
<span class="sd">        coupling (np.ndarray): coupling matrix generated using dispersion_model.</span>

<span class="sd">        sensor_object (SensorGroup): stores sensor information for reversible jump coupling updates.</span>
<span class="sd">        meteorology (MeteorologyGroup): stores meteorology information for reversible jump coupling updates.</span>
<span class="sd">        gas_species (GasSpecies): stores gas species information for reversible jump coupling updates.</span>

<span class="sd">        reversible_jump (bool): logical indicating whether the reversible jump algorithm for estimation of the number</span>
<span class="sd">            of sources and their locations should be run. Defaults to False.</span>
<span class="sd">        distribution_number_sources (str): distribution for the number of sources in the solution. Can be either</span>
<span class="sd">            &quot;Poisson&quot; or &quot;Uniform&quot;. Defaults to &quot;Poisson&quot;.</span>
<span class="sd">        random_walk_step_size (np.ndarray): (3 x 1) array specifying the standard deviations of the distributions</span>
<span class="sd">            from which the random walk sampler draws new source locations. Defaults to np.array([1.0, 1.0, 0.1]).</span>
<span class="sd">        site_limits (np.ndarray): (3 x 2) array specifying the lower (column 0) and upper (column 1) limits of the</span>
<span class="sd">            analysis site. Only relevant for cases where reversible_jump == True (where sources are free to move in</span>
<span class="sd">            the solution).</span>
<span class="sd">        rate_num_sources (int): specification for the parameter for the Poisson prior distribution for the total number</span>
<span class="sd">            of sources. Only relevant for cases where reversible_jump == True (where the number of sources in the</span>
<span class="sd">            solution can change). Unused in the case of a Uniform prior (self.distribution_number_sources == &quot;Uniform&quot;).</span>
<span class="sd">        n_sources_max (int): maximum number of sources that can feature in the solution. Only relevant for cases where</span>
<span class="sd">            reversible_jump == True (where the number of sources in the solution can change).</span>
<span class="sd">        emission_proposal_std (float): standard deviation of the truncated Gaussian distribution used to propose the</span>
<span class="sd">            new source emission rate in case of a birth move.</span>

<span class="sd">        update_precision (bool): logical indicating whether the prior precision parameter for emission rates should be</span>
<span class="sd">            updated as part of the inversion. Defaults to false.</span>
<span class="sd">        prior_precision_shape (Union[float, np.ndarray]): shape parameters for the prior Gamma distribution for the</span>
<span class="sd">            source precision parameter.</span>
<span class="sd">        prior_precision_rate (Union[float, np.ndarray]): rate parameters for the prior Gamma distribution for the</span>
<span class="sd">            source precision parameter.</span>
<span class="sd">        initial_precision (Union[float, np.ndarray]): initial value for the source emission rate precision parameter.</span>
<span class="sd">        precision_scalar (np.ndarray): precision values generated by MCMC inversion.</span>

<span class="sd">        all_source_locations (ENU): ENU object containing the locations of after the mcmc has been run, therefore in</span>
<span class="sd">            the situation where the reversible_jump == True, this will be the final locations of the sources in the</span>
<span class="sd">            solution over all iterations. For the case where reversible_jump == False, this will be the locations of</span>
<span class="sd">            the sources in the source map and will not change during the course of the inversion.</span>
<span class="sd">        individual_source_labels (list, optional): list of labels for each source in the source map, defaults to None.</span>

<span class="sd">        coverage_detection (float): sensor detection threshold (in ppm) to be used for coverage calculations.</span>
<span class="sd">        coverage_test_source (float): test source (in kg/hr) which we wish to be able to see in coverage calculation.</span>

<span class="sd">        threshold_function (Callable): Callable function which returns a single value that defines the threshold</span>
<span class="sd">            for the coupling in a lambda function form. Examples: lambda x: np.quantile(x, 0.95, axis=0),</span>
<span class="sd">            lambda x: np.max(x, axis=0), lambda x: np.mean(x, axis=0). Defaults to np.quantile.</span>
<span class="sd">        label_string (str): string to append to the parameter mapping, e.g. for fixed sources, defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dispersion_model</span><span class="p">:</span> <span class="n">GaussianPlume</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">coupling</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">sensor_object</span><span class="p">:</span> <span class="n">SensorGroup</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">meteorology</span><span class="p">:</span> <span class="n">Meteorology</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gas_species</span><span class="p">:</span> <span class="n">GasSpecies</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">reversible_jump</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">distribution_number_sources</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Poisson&quot;</span>
    <span class="n">random_walk_step_size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">site_limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rate_num_sources</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">n_sources_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">emission_proposal_std</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">update_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">prior_precision_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">prior_precision_rate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">initial_precision</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">precision_scalar</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">all_source_locations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">individual_source_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">coverage_detection</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">coverage_test_source</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.0</span>

    <span class="n">threshold_function</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">label_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post-initialisation of the class.</span>

<span class="sd">        This function is called after the class has been initialised, and is used to set up the mapping dictionary for</span>
<span class="sd">        the class by applying the append_string function to the mapping dictionary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_string</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nof_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get number of sources in the source map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">nof_sources</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">coverage_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute coverage threshold from detection threshold and test source strength.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverage_test_source</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverage_detection</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_object</span><span class="p">:</span> <span class="n">SensorGroup</span><span class="p">,</span> <span class="n">meteorology</span><span class="p">:</span> <span class="n">Meteorology</span><span class="p">,</span> <span class="n">gas_species</span><span class="p">:</span> <span class="n">GasSpecies</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the source model.</span>

<span class="sd">        Extract required information from the sensor, meteorology and gas species objects:</span>
<span class="sd">            - Attach coupling calculated using self.dispersion_model.</span>
<span class="sd">            - (If self.reversible_jump == True) Attach objects to source model which will be used in RJMCMC sampler,</span>
<span class="sd">                they will be required when we need to update the couplings when new source locations are proposed when</span>
<span class="sd">                we move/birth/death.</span>

<span class="sd">        Args:</span>
<span class="sd">            sensor_object (SensorGroup): object containing sensor data.</span>
<span class="sd">            meteorology (MeteorologyGroup): object containing meteorology data.</span>
<span class="sd">            gas_species (GasSpecies): object containing gas species information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_dispersion_model</span><span class="p">(</span><span class="n">sensor_object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">compute_coupling</span><span class="p">(</span>
            <span class="n">sensor_object</span><span class="p">,</span> <span class="n">meteorology</span><span class="p">,</span> <span class="n">gas_species</span><span class="p">,</span> <span class="n">output_stacked</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span> <span class="o">=</span> <span class="n">sensor_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_coverage</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meteorology</span> <span class="o">=</span> <span class="n">meteorology</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gas_species</span> <span class="o">=</span> <span class="n">gas_species</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialise_dispersion_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_object</span><span class="p">:</span> <span class="n">SensorGroup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the dispersion model.</span>

<span class="sd">        If a dispersion_model has already been attached to this instance, then this function takes no action.</span>

<span class="sd">        If a dispersion_model has not already been attached to the instance, then this function adds a GaussianPlume</span>
<span class="sd">        dispersion model, with a default source map that has limits set based on the sensor locations.</span>

<span class="sd">        Args:</span>
<span class="sd">            sensor_object (SensorGroup): object containing sensor data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_map</span> <span class="o">=</span> <span class="n">SourceMap</span><span class="p">()</span>
            <span class="n">sensor_locations</span> <span class="o">=</span> <span class="n">sensor_object</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_enu</span><span class="p">()</span>
            <span class="n">location_object</span> <span class="o">=</span> <span class="n">ENU</span><span class="p">(</span>
                <span class="n">ref_latitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_latitude</span><span class="p">,</span>
                <span class="n">ref_longitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_longitude</span><span class="p">,</span>
                <span class="n">ref_altitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_altitude</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">source_map</span><span class="o">.</span><span class="n">generate_sources</span><span class="p">(</span>
                <span class="n">coordinate_object</span><span class="o">=</span><span class="n">location_object</span><span class="p">,</span>
                <span class="n">sourcemap_limits</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">east</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">east</span><span class="p">)],</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">north</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">north</span><span class="p">)],</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">up</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">up</span><span class="p">)],</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">sourcemap_type</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span> <span class="o">=</span> <span class="n">GaussianPlume</span><span class="p">(</span><span class="n">source_map</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">screen_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Screen the initial source map for coverage.&quot;&quot;&quot;</span>
        <span class="n">in_coverage_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coupling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span><span class="p">[:,</span> <span class="n">in_coverage_area</span><span class="p">]</span>
        <span class="n">all_locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
        <span class="n">screened_locations</span> <span class="o">=</span> <span class="n">all_locations</span><span class="p">[</span><span class="n">in_coverage_area</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">screened_locations</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">couplings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a logical vector that indicates which sources in the couplings are, or are not, within the coverage.</span>

<span class="sd">        The &#39;coverage&#39; is the area inside which all sources are well covered by wind data. E.g. If wind exclusively</span>
<span class="sd">        blows towards East, then all sources to the East of any sensor are &#39;invisible&#39;, and are not within the coverage.</span>

<span class="sd">        Couplings are returned in hr/kg. Some threshold function defines the largest allowed coupling value. This is</span>
<span class="sd">        used to calculate estimated emission rates in kg/hr. Any emissions which are greater than the value of</span>
<span class="sd">        &#39;self.coverage_threshold&#39; are defined as not within the coverage.</span>

<span class="sd">        If sensor_object.source_on is being used only the parts where th coupling is computed are used in the coverage</span>
<span class="sd">        check. This avoids threshold_function being affected by large amounts of zero values.</span>

<span class="sd">        Args:</span>
<span class="sd">            couplings (np.ndarray): Array of coupling values. Dimensions: n_data points x n_sources.</span>
<span class="sd">            kwargs (dict, optional): Keyword arguments required for the threshold function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            coverage (np.ndarray): A logical array specifying which sources are within the coverage.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="o">.</span><span class="n">source_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">couplings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">couplings</span><span class="p">)</span>
            <span class="n">index_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="o">.</span><span class="n">source_on</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">couplings</span> <span class="o">=</span> <span class="n">couplings</span><span class="p">[</span><span class="n">index_keep</span><span class="p">]</span>

        <span class="n">coupling_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_function</span><span class="p">(</span><span class="n">couplings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">no_warning_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coupling_threshold</span> <span class="o">&lt;=</span> <span class="mf">1e-100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coupling_threshold</span><span class="p">)</span>
        <span class="n">no_warning_estimated_emission_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coupling_threshold</span> <span class="o">&lt;=</span> <span class="mf">1e-100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">no_warning_threshold</span><span class="p">)</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="n">no_warning_estimated_emission_rates</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverage_threshold</span>

        <span class="k">return</span> <span class="n">coverage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_coupling_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">update_column</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the coupling, based on changes to the source locations as part of inversion.</span>

<span class="sd">        To be used in two different situations:</span>
<span class="sd">            - movement of source locations (e.g. Metropolis Hastings, random walk).</span>
<span class="sd">            - adding of new source locations (e.g. reversible jump birth move).</span>
<span class="sd">        If [update_column &lt; A.shape[1]]: an existing column of the A matrix is updated.</span>
<span class="sd">        If [update_column == A.shape[1]]: a new column is appended to the right-hand side of the A matrix</span>
<span class="sd">        (corresponding to a new source).</span>

<span class="sd">        A central assumption of this function is that the sensor information and meteorology information</span>
<span class="sd">        have already been interpolated onto the same space/time points.</span>

<span class="sd">        If an update_column is supplied, the coupling for that source location only is calculated to save on</span>
<span class="sd">        computation time. If update_column is None, then we just re-compute the whole coupling matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): dictionary containing state parameters.</span>
<span class="sd">            update_column (int): index of the coupling column to be updated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            state (dict): state dictionary containing updated coupling information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][:,</span> <span class="p">[</span><span class="n">update_column</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">new_coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">compute_coupling</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meteorology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_species</span><span class="p">,</span> <span class="n">output_stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_interpolation</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">update_column</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]],</span> <span class="n">new_coupling</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">update_column</span> <span class="o">&lt;</span> <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="p">[</span><span class="n">update_column</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_coupling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid column specification for updating.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">birth_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update MCMC state based on source birth proposal.</span>

<span class="sd">        Proposed state updated as follows:</span>
<span class="sd">            1- Add column to coupling matrix for new source location.</span>
<span class="sd">            2- If required, adjust other components of the state which correspond to the sources.</span>
<span class="sd">        The source emission rate vector will be adjusted using the standardised functionality</span>
<span class="sd">        in the openMCMC package.</span>

<span class="sd">        After the coupling has been updated, a coverage test is applied for the new source</span>
<span class="sd">        location. If the max coupling is too small, a large contribution is added to the</span>
<span class="sd">        log-proposal density for the new state, to force the sampler to reject it.</span>

<span class="sd">        A central assumption of this function is that the sensor information and meteorology information</span>
<span class="sd">        have already been interpolated onto the same space/time points.</span>

<span class="sd">        This function assumes that the new source location has been added as the final column of</span>
<span class="sd">        the source location matrix, and so will correspondingly append the new coupling column to the right</span>
<span class="sd">        hand side of the current state coupling, and append an emission rate as the last element of the</span>
<span class="sd">        current state emission rate vector.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_state (dict): dictionary containing parameters of the current state.</span>
<span class="sd">            prop_state (dict): dictionary containing the parameters of the proposed state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">            logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">                (i.e. log[p(proposed | current)])</span>
<span class="sd">            logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">                (i.e. log[p(current | proposed)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_coupling_column</span><span class="p">(</span><span class="n">prop_state</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">in_cov_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_cov_area</span><span class="p">:</span>
            <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">1e10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">death_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">deletion_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update MCMC state based on source death proposal.</span>

<span class="sd">        Proposed state updated as follows:</span>
<span class="sd">            1- Remove column from coupling for deleted source.</span>
<span class="sd">            2- If required, adjust other components of the state which correspond to the sources.</span>
<span class="sd">        The source emission rate vector will be adjusted using the standardised functionality in the general_mcmc repo.</span>

<span class="sd">        A central assumption of this function is that the sensor information and meteorology information have already</span>
<span class="sd">        been interpolated onto the same space/time points.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_state (dict): dictionary containing parameters of the current state.</span>
<span class="sd">            prop_state (dict): dictionary containing the parameters of the proposed state.</span>
<span class="sd">            deletion_index (int): index of the source to be deleted in the overall set of sources.</span>

<span class="sd">        Returns:</span>
<span class="sd">            prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">            logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">                (i.e. log[p(proposed | current)])</span>
<span class="sd">            logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">                (i.e. log[p(current | proposed)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]],</span> <span class="n">obj</span><span class="o">=</span><span class="n">deletion_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]],</span> <span class="n">obj</span><span class="o">=</span><span class="n">deletion_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">update_column</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Re-compute the coupling after a source location move.</span>

<span class="sd">        Function first updates the coupling column, and then checks whether the location passes a coverage test. If the</span>
<span class="sd">        location does not have good enough coverage, we return a high log-probability of the move to reject.</span>

<span class="sd">        Args:</span>
<span class="sd">            prop_state (dict): dictionary containing parameters of the proposed state.</span>
<span class="sd">            update_column (int): index of the coupling column to be updated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">            logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">                (i.e. log[p(proposed | current)])</span>
<span class="sd">            logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">                (i.e. log[p(current | proposed)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_coupling_column</span><span class="p">(</span><span class="n">prop_state</span><span class="p">,</span> <span class="n">update_column</span><span class="p">)</span>
        <span class="n">in_cov_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="n">update_column</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_cov_area</span><span class="p">:</span>
            <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">1e10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take model list and append new elements from current model component.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (list): Current list of model elements.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: model list updated with source-related distributions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Gamma</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span>
                    <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_shape&quot;</span><span class="p">],</span>
                    <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_rate&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Uniform</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
                    <span class="n">domain_response_lower</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="n">domain_response_upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_number_sources</span> <span class="o">==</span> <span class="s2">&quot;Uniform&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Uniform</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span>
                        <span class="n">domain_response_lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">domain_response_upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_number_sources</span> <span class="o">==</span> <span class="s2">&quot;Poisson&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Poisson</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_source_rate&quot;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid distribution type for number of sources.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take sampler list and append new elements from current model component.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): Full model list of distributions.</span>
<span class="sd">            sampler_list (list): Current list of samplers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: sampler list updated with source-related samplers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
        <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
            <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NormalGamma</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span> <span class="n">model</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
            <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sampler_rjmcmc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sampler_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take state dictionary and append initial values from model component.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (dict): current state vector.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: current state vector with source-related parameters added.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_shape&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_precision_shape</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_rate&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_precision_rate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
            <span class="p">)</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_source_rate&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_num_sources</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_sampler_rjmcmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the parts of the sampler related to the reversible jump MCMC scheme.</span>

<span class="sd">        RJ MCMC scheme:</span>
<span class="sd">            - create the RandomWalkLoop sampler object which updates the source locations one-at-a-time.</span>
<span class="sd">            - create the ReversibleJump sampler which proposes birth/death moves to add/remove sources from the source</span>
<span class="sd">                map.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): model object containing probability density objects for all uncertain</span>
<span class="sd">                parameters.</span>
<span class="sd">            sampler_list (list): list of existing samplers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            sampler_list (list): list of samplers updated with samplers corresponding to RJMCMC routine.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sampler</span> <span class="ow">in</span> <span class="n">sampler_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]:</span>
                <span class="n">sampler</span><span class="o">.</span><span class="n">max_variable_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span>

        <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">RandomWalkLoop</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_walk_step_size</span><span class="p">,</span>
                <span class="n">max_variable_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">),</span>
                <span class="n">domain_limits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">,</span>
                <span class="n">state_update_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">move_function</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">matching_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
            <span class="s2">&quot;matrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">],</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;limits&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ReversibleJump</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">step</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">associated_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
                <span class="n">n_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">,</span>
                <span class="n">state_birth_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">birth_function</span><span class="p">,</span>
                <span class="n">state_death_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">death_function</span><span class="p">,</span>
                <span class="n">matching_params</span><span class="o">=</span><span class="n">matching_params</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">sampler_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract results of mcmc from mcmc.store and attach to components.</span>

<span class="sd">        For the reversible jump case we extract all estimated source locations</span>
<span class="sd">        per iteration. For the fixed sources case we grab the source locations</span>
<span class="sd">        from the inputted sourcemap and repeat those for all iterations.</span>

<span class="sd">        Args:</span>
<span class="sd">            store (dict): mcmc result dictionary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_mcmc_group</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_mcmc_dist</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">individual_source_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">individual_source_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision_scalar</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
            <span class="n">reference_latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_latitude</span>
            <span class="n">reference_longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_longitude</span>
            <span class="n">ref_altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_altitude</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_source_locations</span> <span class="o">=</span> <span class="n">ENU</span><span class="p">(</span>
                <span class="n">ref_latitude</span><span class="o">=</span><span class="n">reference_latitude</span><span class="p">,</span>
                <span class="n">ref_longitude</span><span class="o">=</span><span class="n">reference_longitude</span><span class="p">,</span>
                <span class="n">ref_altitude</span><span class="o">=</span><span class="n">ref_altitude</span><span class="p">,</span>
                <span class="n">east</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                <span class="n">north</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                <span class="n">up</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">location_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_enu</span><span class="p">()</span>
            <span class="n">location_temp</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">east</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">location_temp</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">north</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">location_temp</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">up</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_source_locations</span> <span class="o">=</span> <span class="n">location_temp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span> <span class="n">burn_in_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Plot&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the emission rate estimates source model object against MCMC iteration.</span>

<span class="sd">        Args:</span>
<span class="sd">            burn_in_value (int): Burn in value to show in plot.</span>
<span class="sd">            y_axis_type (str, optional): String to indicate whether the y-axis should be linear of log scale.</span>
<span class="sd">            plot (Plot): Plot object to which this figure will be added in the figure dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (Plot): Plot object to which the figures added in the figure dictionary with</span>
<span class="sd">                keys &#39;estimated_values_plot&#39;/&#39;log_estimated_values_plot&#39; and &#39;number_of_sources_plot&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">plot_emission_rate_estimates</span><span class="p">(</span><span class="n">source_model_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">burn_in</span><span class="o">=</span><span class="n">burn_in_value</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="o">=</span><span class="n">y_axis_type</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">plot_single_trace</span><span class="p">(</span><span class="n">object_to_plot</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyelq.component.source_model.SourceModel.nof_sources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nof_sources</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get number of sources in the source map.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyelq.component.source_model.SourceModel.coverage_threshold" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coverage_threshold</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Compute coverage threshold from detection threshold and test source strength.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Post-initialisation of the class.</p>
<p>This function is called after the class has been initialised, and is used to set up the mapping dictionary for
the class by applying the append_string function to the mapping dictionary.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-initialisation of the class.</span>

<span class="sd">    This function is called after the class has been initialised, and is used to set up the mapping dictionary for</span>
<span class="sd">    the class by applying the append_string function to the mapping dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.initialise" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialise</span><span class="p">(</span><span class="n">sensor_object</span><span class="p">,</span> <span class="n">meteorology</span><span class="p">,</span> <span class="n">gas_species</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set up the source model.</p>
<p>Extract required information from the sensor, meteorology and gas species objects:
    - Attach coupling calculated using self.dispersion_model.
    - (If self.reversible_jump == True) Attach objects to source model which will be used in RJMCMC sampler,
        they will be required when we need to update the couplings when new source locations are proposed when
        we move/birth/death.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sensor_object</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SensorGroup&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.sensor.sensor.SensorGroup&lt;/code&gt;)" href="../../sensor/sensor/#pyelq.sensor.sensor.SensorGroup">SensorGroup</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object containing sensor data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>meteorology</code>
            </td>
            <td>
                  <code><span title="MeteorologyGroup">MeteorologyGroup</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object containing meteorology data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gas_species</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;GasSpecies&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.gas_species.GasSpecies&lt;/code&gt;)" href="../../gas_species/#pyelq.gas_species.GasSpecies">GasSpecies</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object containing gas species information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_object</span><span class="p">:</span> <span class="n">SensorGroup</span><span class="p">,</span> <span class="n">meteorology</span><span class="p">:</span> <span class="n">Meteorology</span><span class="p">,</span> <span class="n">gas_species</span><span class="p">:</span> <span class="n">GasSpecies</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the source model.</span>

<span class="sd">    Extract required information from the sensor, meteorology and gas species objects:</span>
<span class="sd">        - Attach coupling calculated using self.dispersion_model.</span>
<span class="sd">        - (If self.reversible_jump == True) Attach objects to source model which will be used in RJMCMC sampler,</span>
<span class="sd">            they will be required when we need to update the couplings when new source locations are proposed when</span>
<span class="sd">            we move/birth/death.</span>

<span class="sd">    Args:</span>
<span class="sd">        sensor_object (SensorGroup): object containing sensor data.</span>
<span class="sd">        meteorology (MeteorologyGroup): object containing meteorology data.</span>
<span class="sd">        gas_species (GasSpecies): object containing gas species information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialise_dispersion_model</span><span class="p">(</span><span class="n">sensor_object</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">compute_coupling</span><span class="p">(</span>
        <span class="n">sensor_object</span><span class="p">,</span> <span class="n">meteorology</span><span class="p">,</span> <span class="n">gas_species</span><span class="p">,</span> <span class="n">output_stacked</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span> <span class="o">=</span> <span class="n">sensor_object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">screen_coverage</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meteorology</span> <span class="o">=</span> <span class="n">meteorology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gas_species</span> <span class="o">=</span> <span class="n">gas_species</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.initialise_dispersion_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialise_dispersion_model</span><span class="p">(</span><span class="n">sensor_object</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the dispersion model.</p>
<p>If a dispersion_model has already been attached to this instance, then this function takes no action.</p>
<p>If a dispersion_model has not already been attached to the instance, then this function adds a GaussianPlume
dispersion model, with a default source map that has limits set based on the sensor locations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sensor_object</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SensorGroup&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.sensor.sensor.SensorGroup&lt;/code&gt;)" href="../../sensor/sensor/#pyelq.sensor.sensor.SensorGroup">SensorGroup</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object containing sensor data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialise_dispersion_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_object</span><span class="p">:</span> <span class="n">SensorGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the dispersion model.</span>

<span class="sd">    If a dispersion_model has already been attached to this instance, then this function takes no action.</span>

<span class="sd">    If a dispersion_model has not already been attached to the instance, then this function adds a GaussianPlume</span>
<span class="sd">    dispersion model, with a default source map that has limits set based on the sensor locations.</span>

<span class="sd">    Args:</span>
<span class="sd">        sensor_object (SensorGroup): object containing sensor data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_map</span> <span class="o">=</span> <span class="n">SourceMap</span><span class="p">()</span>
        <span class="n">sensor_locations</span> <span class="o">=</span> <span class="n">sensor_object</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_enu</span><span class="p">()</span>
        <span class="n">location_object</span> <span class="o">=</span> <span class="n">ENU</span><span class="p">(</span>
            <span class="n">ref_latitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_latitude</span><span class="p">,</span>
            <span class="n">ref_longitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_longitude</span><span class="p">,</span>
            <span class="n">ref_altitude</span><span class="o">=</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">ref_altitude</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">source_map</span><span class="o">.</span><span class="n">generate_sources</span><span class="p">(</span>
            <span class="n">coordinate_object</span><span class="o">=</span><span class="n">location_object</span><span class="p">,</span>
            <span class="n">sourcemap_limits</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">east</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">east</span><span class="p">)],</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">north</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">north</span><span class="p">)],</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">up</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensor_locations</span><span class="o">.</span><span class="n">up</span><span class="p">)],</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">sourcemap_type</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span> <span class="o">=</span> <span class="n">GaussianPlume</span><span class="p">(</span><span class="n">source_map</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.screen_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">screen_coverage</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Screen the initial source map for coverage.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">screen_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Screen the initial source map for coverage.&quot;&quot;&quot;</span>
    <span class="n">in_coverage_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coupling</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span><span class="p">[:,</span> <span class="n">in_coverage_area</span><span class="p">]</span>
    <span class="n">all_locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
    <span class="n">screened_locations</span> <span class="o">=</span> <span class="n">all_locations</span><span class="p">[</span><span class="n">in_coverage_area</span><span class="p">,</span> <span class="p">:]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">screened_locations</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.compute_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_coverage</span><span class="p">(</span><span class="n">couplings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a logical vector that indicates which sources in the couplings are, or are not, within the coverage.</p>
<p>The 'coverage' is the area inside which all sources are well covered by wind data. E.g. If wind exclusively
blows towards East, then all sources to the East of any sensor are 'invisible', and are not within the coverage.</p>
<p>Couplings are returned in hr/kg. Some threshold function defines the largest allowed coupling value. This is
used to calculate estimated emission rates in kg/hr. Any emissions which are greater than the value of
'self.coverage_threshold' are defined as not within the coverage.</p>
<p>If sensor_object.source_on is being used only the parts where th coupling is computed are used in the coverage
check. This avoids threshold_function being affected by large amounts of zero values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>couplings</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of coupling values. Dimensions: n_data points x n_sources.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments required for the threshold function.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>coverage</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A logical array specifying which sources are within the coverage.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">couplings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a logical vector that indicates which sources in the couplings are, or are not, within the coverage.</span>

<span class="sd">    The &#39;coverage&#39; is the area inside which all sources are well covered by wind data. E.g. If wind exclusively</span>
<span class="sd">    blows towards East, then all sources to the East of any sensor are &#39;invisible&#39;, and are not within the coverage.</span>

<span class="sd">    Couplings are returned in hr/kg. Some threshold function defines the largest allowed coupling value. This is</span>
<span class="sd">    used to calculate estimated emission rates in kg/hr. Any emissions which are greater than the value of</span>
<span class="sd">    &#39;self.coverage_threshold&#39; are defined as not within the coverage.</span>

<span class="sd">    If sensor_object.source_on is being used only the parts where th coupling is computed are used in the coverage</span>
<span class="sd">    check. This avoids threshold_function being affected by large amounts of zero values.</span>

<span class="sd">    Args:</span>
<span class="sd">        couplings (np.ndarray): Array of coupling values. Dimensions: n_data points x n_sources.</span>
<span class="sd">        kwargs (dict, optional): Keyword arguments required for the threshold function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        coverage (np.ndarray): A logical array specifying which sources are within the coverage.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="o">.</span><span class="n">source_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">couplings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">couplings</span><span class="p">)</span>
        <span class="n">index_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="o">.</span><span class="n">source_on</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">couplings</span> <span class="o">=</span> <span class="n">couplings</span><span class="p">[</span><span class="n">index_keep</span><span class="p">]</span>

    <span class="n">coupling_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_function</span><span class="p">(</span><span class="n">couplings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">no_warning_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coupling_threshold</span> <span class="o">&lt;=</span> <span class="mf">1e-100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coupling_threshold</span><span class="p">)</span>
    <span class="n">no_warning_estimated_emission_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coupling_threshold</span> <span class="o">&lt;=</span> <span class="mf">1e-100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">no_warning_threshold</span><span class="p">)</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="n">no_warning_estimated_emission_rates</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverage_threshold</span>

    <span class="k">return</span> <span class="n">coverage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.update_coupling_column" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_coupling_column</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">update_column</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the coupling, based on changes to the source locations as part of inversion.</p>


<details class="to-be-used-in-two-different-situations" open>
  <summary>To be used in two different situations</summary>
  <ul>
<li>movement of source locations (e.g. Metropolis Hastings, random walk).</li>
<li>adding of new source locations (e.g. reversible jump birth move).</li>
</ul>
</details>        <p>If [update_column &lt; A.shape[1]]: an existing column of the A matrix is updated.
If [update_column == A.shape[1]]: a new column is appended to the right-hand side of the A matrix
(corresponding to a new source).</p>
<p>A central assumption of this function is that the sensor information and meteorology information
have already been interpolated onto the same space/time points.</p>
<p>If an update_column is supplied, the coupling for that source location only is calculated to save on
computation time. If update_column is None, then we just re-compute the whole coupling matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing state parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_column</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index of the coupling column to be updated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state dictionary containing updated coupling information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_coupling_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">update_column</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the coupling, based on changes to the source locations as part of inversion.</span>

<span class="sd">    To be used in two different situations:</span>
<span class="sd">        - movement of source locations (e.g. Metropolis Hastings, random walk).</span>
<span class="sd">        - adding of new source locations (e.g. reversible jump birth move).</span>
<span class="sd">    If [update_column &lt; A.shape[1]]: an existing column of the A matrix is updated.</span>
<span class="sd">    If [update_column == A.shape[1]]: a new column is appended to the right-hand side of the A matrix</span>
<span class="sd">    (corresponding to a new source).</span>

<span class="sd">    A central assumption of this function is that the sensor information and meteorology information</span>
<span class="sd">    have already been interpolated onto the same space/time points.</span>

<span class="sd">    If an update_column is supplied, the coupling for that source location only is calculated to save on</span>
<span class="sd">    computation time. If update_column is None, then we just re-compute the whole coupling matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): dictionary containing state parameters.</span>
<span class="sd">        update_column (int): index of the coupling column to be updated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        state (dict): state dictionary containing updated coupling information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][:,</span> <span class="p">[</span><span class="n">update_column</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">new_coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">compute_coupling</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meteorology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_species</span><span class="p">,</span> <span class="n">output_stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_interpolation</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">update_column</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]],</span> <span class="n">new_coupling</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">update_column</span> <span class="o">&lt;</span> <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="p">[</span><span class="n">update_column</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_coupling</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid column specification for updating.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.birth_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">birth_function</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update MCMC state based on source birth proposal.</p>


<details class="proposed-state-updated-as-follows" open>
  <summary>Proposed state updated as follows</summary>
  <p>1- Add column to coupling matrix for new source location.
2- If required, adjust other components of the state which correspond to the sources.</p>
</details>        <p>The source emission rate vector will be adjusted using the standardised functionality
in the openMCMC package.</p>
<p>After the coupling has been updated, a coverage test is applied for the new source
location. If the max coupling is too small, a large contribution is added to the
log-proposal density for the new state, to force the sampler to reject it.</p>
<p>A central assumption of this function is that the sensor information and meteorology information
have already been interpolated onto the same space/time points.</p>
<p>This function assumes that the new source location has been added as the final column of
the source location matrix, and so will correspondingly append the new coupling column to the right
hand side of the current state coupling, and append an emission rate as the last element of the
current state emission rate vector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing parameters of the current state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prop_state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing the parameters of the proposed state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>prop_state</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>proposed state, with coupling matrix and source emission rate vector updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_pr_g_cr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the proposed state given the current state
(i.e. log[p(proposed | current)])</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_cr_g_pr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the current state given the proposed state
(i.e. log[p(current | proposed)])</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">birth_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update MCMC state based on source birth proposal.</span>

<span class="sd">    Proposed state updated as follows:</span>
<span class="sd">        1- Add column to coupling matrix for new source location.</span>
<span class="sd">        2- If required, adjust other components of the state which correspond to the sources.</span>
<span class="sd">    The source emission rate vector will be adjusted using the standardised functionality</span>
<span class="sd">    in the openMCMC package.</span>

<span class="sd">    After the coupling has been updated, a coverage test is applied for the new source</span>
<span class="sd">    location. If the max coupling is too small, a large contribution is added to the</span>
<span class="sd">    log-proposal density for the new state, to force the sampler to reject it.</span>

<span class="sd">    A central assumption of this function is that the sensor information and meteorology information</span>
<span class="sd">    have already been interpolated onto the same space/time points.</span>

<span class="sd">    This function assumes that the new source location has been added as the final column of</span>
<span class="sd">    the source location matrix, and so will correspondingly append the new coupling column to the right</span>
<span class="sd">    hand side of the current state coupling, and append an emission rate as the last element of the</span>
<span class="sd">    current state emission rate vector.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_state (dict): dictionary containing parameters of the current state.</span>
<span class="sd">        prop_state (dict): dictionary containing the parameters of the proposed state.</span>

<span class="sd">    Returns:</span>
<span class="sd">        prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">        logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">            (i.e. log[p(proposed | current)])</span>
<span class="sd">        logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">            (i.e. log[p(current | proposed)])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prop_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_coupling_column</span><span class="p">(</span><span class="n">prop_state</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">in_cov_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_cov_area</span><span class="p">:</span>
        <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">1e10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.death_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">death_function</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">deletion_index</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update MCMC state based on source death proposal.</p>


<details class="proposed-state-updated-as-follows" open>
  <summary>Proposed state updated as follows</summary>
  <p>1- Remove column from coupling for deleted source.
2- If required, adjust other components of the state which correspond to the sources.</p>
</details>        <p>The source emission rate vector will be adjusted using the standardised functionality in the general_mcmc repo.</p>
<p>A central assumption of this function is that the sensor information and meteorology information have already
been interpolated onto the same space/time points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing parameters of the current state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prop_state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing the parameters of the proposed state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deletion_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index of the source to be deleted in the overall set of sources.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>prop_state</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>proposed state, with coupling matrix and source emission rate vector updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_pr_g_cr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the proposed state given the current state
(i.e. log[p(proposed | current)])</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_cr_g_pr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the current state given the proposed state
(i.e. log[p(current | proposed)])</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">death_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">deletion_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update MCMC state based on source death proposal.</span>

<span class="sd">    Proposed state updated as follows:</span>
<span class="sd">        1- Remove column from coupling for deleted source.</span>
<span class="sd">        2- If required, adjust other components of the state which correspond to the sources.</span>
<span class="sd">    The source emission rate vector will be adjusted using the standardised functionality in the general_mcmc repo.</span>

<span class="sd">    A central assumption of this function is that the sensor information and meteorology information have already</span>
<span class="sd">    been interpolated onto the same space/time points.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_state (dict): dictionary containing parameters of the current state.</span>
<span class="sd">        prop_state (dict): dictionary containing the parameters of the proposed state.</span>
<span class="sd">        deletion_index (int): index of the source to be deleted in the overall set of sources.</span>

<span class="sd">    Returns:</span>
<span class="sd">        prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">        logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">            (i.e. log[p(proposed | current)])</span>
<span class="sd">        logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">            (i.e. log[p(current | proposed)])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
        <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]],</span> <span class="n">obj</span><span class="o">=</span><span class="n">deletion_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;allocation&quot;</span><span class="p">]],</span> <span class="n">obj</span><span class="o">=</span><span class="n">deletion_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.move_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move_function</span><span class="p">(</span><span class="n">prop_state</span><span class="p">,</span> <span class="n">update_column</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Re-compute the coupling after a source location move.</p>
<p>Function first updates the coupling column, and then checks whether the location passes a coverage test. If the
location does not have good enough coverage, we return a high log-probability of the move to reject.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prop_state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing parameters of the proposed state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_column</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index of the coupling column to be updated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>prop_state</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>proposed state, with coupling matrix and source emission rate vector updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_pr_g_cr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the proposed state given the current state
(i.e. log[p(proposed | current)])</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>logp_cr_g_pr</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log-transition density of the current state given the proposed state
(i.e. log[p(current | proposed)])</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">move_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">update_column</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Re-compute the coupling after a source location move.</span>

<span class="sd">    Function first updates the coupling column, and then checks whether the location passes a coverage test. If the</span>
<span class="sd">    location does not have good enough coverage, we return a high log-probability of the move to reject.</span>

<span class="sd">    Args:</span>
<span class="sd">        prop_state (dict): dictionary containing parameters of the proposed state.</span>
<span class="sd">        update_column (int): index of the coupling column to be updated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        prop_state (dict): proposed state, with coupling matrix and source emission rate vector updated.</span>
<span class="sd">        logp_pr_g_cr (float): log-transition density of the proposed state given the current state</span>
<span class="sd">            (i.e. log[p(proposed | current)])</span>
<span class="sd">        logp_cr_g_pr (float): log-transition density of the current state given the proposed state</span>
<span class="sd">            (i.e. log[p(current | proposed)])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prop_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_coupling_column</span><span class="p">(</span><span class="n">prop_state</span><span class="p">,</span> <span class="n">update_column</span><span class="p">)</span>
    <span class="n">in_cov_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_coverage</span><span class="p">(</span><span class="n">prop_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]][:,</span> <span class="n">update_column</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_cov_area</span><span class="p">:</span>
        <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">1e10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logp_pr_g_cr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">logp_cr_g_pr</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">prop_state</span><span class="p">,</span> <span class="n">logp_pr_g_cr</span><span class="p">,</span> <span class="n">logp_cr_g_pr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.make_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Take model list and append new elements from current model component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current list of model elements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model list updated with source-related distributions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take model list and append new elements from current model component.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (list): Current list of model elements.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: model list updated with source-related distributions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Gamma</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span>
                <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_shape&quot;</span><span class="p">],</span>
                <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_rate&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Uniform</span><span class="p">(</span>
                <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
                <span class="n">domain_response_lower</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">domain_response_upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_number_sources</span> <span class="o">==</span> <span class="s2">&quot;Uniform&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Uniform</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span>
                    <span class="n">domain_response_lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">domain_response_upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_number_sources</span> <span class="o">==</span> <span class="s2">&quot;Poisson&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Poisson</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_source_rate&quot;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid distribution type for number of sources.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.make_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Take sampler list and append new elements from current model component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full model list of distributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current list of samplers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampler list updated with source-related samplers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take sampler list and append new elements from current model component.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): Full model list of distributions.</span>
<span class="sd">        sampler_list (list): Current list of samplers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: sampler list updated with source-related samplers.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
    <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_sampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
        <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NormalGamma</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">],</span> <span class="n">model</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
        <span class="n">sampler_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sampler_rjmcmc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sampler_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.make_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Take state dictionary and append initial values from model component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state vector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state vector with source-related parameters added.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take state dictionary and append initial values from model component.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict): current state vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: current state vector with source-related parameters added.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_allocation_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_source_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling</span>
    <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_shape&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_precision_shape</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;precision_prior_rate&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_precision</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_precision_rate</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
        <span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_source_rate&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_num_sources</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.make_sampler_rjmcmc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_sampler_rjmcmc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create the parts of the sampler related to the reversible jump MCMC scheme.</p>


<details class="rj-mcmc-scheme" open>
  <summary>RJ MCMC scheme</summary>
  <ul>
<li>create the RandomWalkLoop sampler object which updates the source locations one-at-a-time.</li>
<li>create the ReversibleJump sampler which proposes birth/death moves to add/remove sources from the source
    map.</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="openmcmc.model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model object containing probability density objects for all uncertain
parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampler_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of existing samplers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sampler_list</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of samplers updated with samplers corresponding to RJMCMC routine.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_sampler_rjmcmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sampler_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the parts of the sampler related to the reversible jump MCMC scheme.</span>

<span class="sd">    RJ MCMC scheme:</span>
<span class="sd">        - create the RandomWalkLoop sampler object which updates the source locations one-at-a-time.</span>
<span class="sd">        - create the ReversibleJump sampler which proposes birth/death moves to add/remove sources from the source</span>
<span class="sd">            map.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (Model): model object containing probability density objects for all uncertain</span>
<span class="sd">            parameters.</span>
<span class="sd">        sampler_list (list): list of existing samplers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sampler_list (list): list of samplers updated with samplers corresponding to RJMCMC routine.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sampler</span> <span class="ow">in</span> <span class="n">sampler_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]:</span>
            <span class="n">sampler</span><span class="o">.</span><span class="n">max_variable_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span>

    <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">RandomWalkLoop</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_walk_step_size</span><span class="p">,</span>
            <span class="n">max_variable_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">),</span>
            <span class="n">domain_limits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site_limits</span><span class="p">,</span>
            <span class="n">state_update_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">move_function</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">matching_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
        <span class="s2">&quot;matrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;coupling_matrix&quot;</span><span class="p">],</span>
        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;limits&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">sampler_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">ReversibleJump</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;number_sources&quot;</span><span class="p">],</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">associated_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">],</span>
            <span class="n">n_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sources_max</span><span class="p">,</span>
            <span class="n">state_birth_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">birth_function</span><span class="p">,</span>
            <span class="n">state_death_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">death_function</span><span class="p">,</span>
            <span class="n">matching_params</span><span class="o">=</span><span class="n">matching_params</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sampler_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.from_mcmc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_mcmc</span><span class="p">(</span><span class="n">store</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract results of mcmc from mcmc.store and attach to components.</p>
<p>For the reversible jump case we extract all estimated source locations
per iteration. For the fixed sources case we grab the source locations
from the inputted sourcemap and repeat those for all iterations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mcmc result dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_mcmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract results of mcmc from mcmc.store and attach to components.</span>

<span class="sd">    For the reversible jump case we extract all estimated source locations</span>
<span class="sd">    per iteration. For the fixed sources case we grab the source locations</span>
<span class="sd">    from the inputted sourcemap and repeat those for all iterations.</span>

<span class="sd">    Args:</span>
<span class="sd">        store (dict): mcmc result dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_mcmc_group</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_mcmc_dist</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">individual_source_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">individual_source_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_precision</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision_scalar</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;emission_rate_precision&quot;</span><span class="p">]]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversible_jump</span><span class="p">:</span>
        <span class="n">reference_latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_latitude</span>
        <span class="n">reference_longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_longitude</span>
        <span class="n">ref_altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">ref_altitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_source_locations</span> <span class="o">=</span> <span class="n">ENU</span><span class="p">(</span>
            <span class="n">ref_latitude</span><span class="o">=</span><span class="n">reference_latitude</span><span class="p">,</span>
            <span class="n">ref_longitude</span><span class="o">=</span><span class="n">reference_longitude</span><span class="p">,</span>
            <span class="n">ref_altitude</span><span class="o">=</span><span class="n">ref_altitude</span><span class="p">,</span>
            <span class="n">east</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
            <span class="n">north</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
            <span class="n">up</span><span class="o">=</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s2">&quot;source_location&quot;</span><span class="p">]][</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">location_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispersion_model</span><span class="o">.</span><span class="n">source_map</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">to_enu</span><span class="p">()</span>
        <span class="n">location_temp</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">east</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">location_temp</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">north</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">location_temp</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">location_temp</span><span class="o">.</span><span class="n">up</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_source_locations</span> <span class="o">=</span> <span class="n">location_temp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyelq.component.source_model.SourceModel.plot_iterations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_iterations</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">burn_in_value</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the emission rate estimates source model object against MCMC iteration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>burn_in_value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Burn in value to show in plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_axis_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String to indicate whether the y-axis should be linear of log scale.</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;Plot&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.plotting.plot.Plot&lt;/code&gt;)" href="../../plotting/plot/#pyelq.plotting.plot.Plot">Plot</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plot object to which this figure will be added in the figure dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;Plot&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.plotting.plot.Plot&lt;/code&gt;)" href="../../plotting/plot/#pyelq.plotting.plot.Plot">Plot</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plot object to which the figures added in the figure dictionary with
keys 'estimated_values_plot'/'log_estimated_values_plot' and 'number_of_sources_plot'</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span> <span class="n">burn_in_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Plot&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the emission rate estimates source model object against MCMC iteration.</span>

<span class="sd">    Args:</span>
<span class="sd">        burn_in_value (int): Burn in value to show in plot.</span>
<span class="sd">        y_axis_type (str, optional): String to indicate whether the y-axis should be linear of log scale.</span>
<span class="sd">        plot (Plot): Plot object to which this figure will be added in the figure dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (Plot): Plot object to which the figures added in the figure dictionary with</span>
<span class="sd">            keys &#39;estimated_values_plot&#39;/&#39;log_estimated_values_plot&#39; and &#39;number_of_sources_plot&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">plot_emission_rate_estimates</span><span class="p">(</span><span class="n">source_model_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">burn_in</span><span class="o">=</span><span class="n">burn_in_value</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="o">=</span><span class="n">y_axis_type</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">plot_single_trace</span><span class="p">(</span><span class="n">object_to_plot</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.Normal" class="doc doc-heading">
            <code>Normal</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceModel&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceModel&lt;/code&gt;)" href="#pyelq.component.source_model.SourceModel">SourceModel</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;NullGrouping&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.NullGrouping&lt;/code&gt;)" href="#pyelq.component.source_model.NullGrouping">NullGrouping</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;NormalResponse&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.NormalResponse&lt;/code&gt;)" href="#pyelq.component.source_model.NormalResponse">NormalResponse</a></code></p>



        <p>Normal model, with null allocation.</p>
<p>(Truncated) Gaussian prior for emission rates, no grouping/allocation; no transformation applied to emission rate
parameters.</p>


<details class="can-be-used-in-the-following-cases" open>
  <summary>Can be used in the following cases</summary>
  <ul>
<li>Fixed set of sources (grid or specific locations), all with the same Gaussian prior distribution.</li>
<li>Variable number of sources, with a common prior distribution, estimated using reversible jump MCMC.</li>
<li>Fixed set of sources with a bespoke prior per source (using the allocation to map prior parameters onto
    sources).</li>
</ul>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Normal</span><span class="p">(</span><span class="n">SourceModel</span><span class="p">,</span> <span class="n">NullGrouping</span><span class="p">,</span> <span class="n">NormalResponse</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normal model, with null allocation.</span>

<span class="sd">    (Truncated) Gaussian prior for emission rates, no grouping/allocation; no transformation applied to emission rate</span>
<span class="sd">    parameters.</span>

<span class="sd">    Can be used in the following cases:</span>
<span class="sd">        - Fixed set of sources (grid or specific locations), all with the same Gaussian prior distribution.</span>
<span class="sd">        - Variable number of sources, with a common prior distribution, estimated using reversible jump MCMC.</span>
<span class="sd">        - Fixed set of sources with a bespoke prior per source (using the allocation to map prior parameters onto</span>
<span class="sd">            sources).</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyelq.component.source_model.NormalSlabAndSpike" class="doc doc-heading">
            <code>NormalSlabAndSpike</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SourceModel&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SourceModel&lt;/code&gt;)" href="#pyelq.component.source_model.SourceModel">SourceModel</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;SlabAndSpike&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.SlabAndSpike&lt;/code&gt;)" href="#pyelq.component.source_model.SlabAndSpike">SlabAndSpike</a></code>, <code><a class="autorefs autorefs-internal" title="&lt;code&gt;NormalResponse&lt;/code&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;pyelq.component.source_model.NormalResponse&lt;/code&gt;)" href="#pyelq.component.source_model.NormalResponse">NormalResponse</a></code></p>



        <p>Normal Slab and Spike model.</p>
<p>(Truncated) Gaussian prior for emission rates, slab and spike prior, with allocation estimation; no transformation
applied to emission rate parameters.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.NormalSlabAndSpike.initial_precision">initial_precision</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial precision parameter for a slab and spike case. shape=(2, 1).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyelq.component.source_model.NormalSlabAndSpike.emission_rate_mean">emission_rate_mean</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>emission rate prior mean for a slab and spike case. shape=(2, 1).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyelq/component/source_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NormalSlabAndSpike</span><span class="p">(</span><span class="n">SourceModel</span><span class="p">,</span> <span class="n">SlabAndSpike</span><span class="p">,</span> <span class="n">NormalResponse</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normal Slab and Spike model.</span>

<span class="sd">    (Truncated) Gaussian prior for emission rates, slab and spike prior, with allocation estimation; no transformation</span>
<span class="sd">    applied to emission rate parameters.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        initial_precision (np.ndarray): initial precision parameter for a slab and spike case. shape=(2, 1).</span>
<span class="sd">        emission_rate_mean (np.ndarray): emission rate prior mean for a slab and spike case. shape=(2, 1).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_precision</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.01</span><span class="o">**</span><span class="mi">2</span><span class="p">)],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">emission_rate_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.top", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": {"Pipelines": "pipelines"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>